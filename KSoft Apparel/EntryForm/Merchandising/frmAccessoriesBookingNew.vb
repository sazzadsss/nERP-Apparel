Imports System.DataImports System.Data.SqlClientImports DevExpress.XtraGrid.ColumnsPublic Class frmAccessoriesBookingNew    Private AddFlag As Boolean = False    Private Sub frmAccessoriesBookingNew_KeyDown(ByVal sender As Object, ByVal e As System.Windows.Forms.KeyEventArgs) Handles Me.KeyDown        If e.KeyData = Keys.F11 Then            If AccessoresBookingDetailsGridControl.IsFocused Then                If GridView1.FocusedColumn.AbsoluteIndex = colFabricColorId.AbsoluteIndex Then                    frmFabricColor.ShowDialog()                    If frmFabricColor.DialogResult = System.Windows.Forms.DialogResult.OK Then

                        'Me.OrderFabricColorTableAdapter.Fill(Me.OrderFabricColorDataSet.OrderFabricColor)

                        Dim row As AccessoriesBookingNewDataSet.AccessoresBookingDetailsRow                        row = CType(CType(Me.AccessoresBookingDetailsBindingSource.Current, DataRowView).Row, AccessoriesBookingNewDataSet.AccessoresBookingDetailsRow)                        row.FabricColorId = frmFabricColor.FabricColorId                    End If                End If            End If

        End If    End Sub    Private Sub frmAccessoriesBookingNew_Load(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles MyBase.Load
        'TODO: This line of code loads data into the 'AccessoriesBookingNewDataSet.AccessoriesBookingAmndDetails' table. You can move, or remove it, as needed.
        Me.AccessoriesBookingAmndDetailsTableAdapter.Fill(Me.AccessoriesBookingNewDataSet.AccessoriesBookingAmndDetails)        Me.CareLabelTableAdapter.Fill(Me.CareLabelDataSet.CareLabel)        Me.AccessoriesBookingCareLableTableAdapter.Fill(Me.AccessoriesBookingNewDataSet.AccessoriesBookingCareLable)        Me.ProgramNoLookupByDivUserTableAdapter.Fill(Me.OrderLookupDataSet.ProgramNoLookupByDivUser, UserId)        Me.AccBookingLookupTableAdapter.FillByUserId(Me.AccBOMLookUpDataSet.AccBookingLookup, UserId)        Me.AccOrderLookupTableAdapter.FillByUserId(Me.AccessoriesBookingNewDataSet.AccOrderLookup, UserId)        Me.ItemStyleTableAdapter.Fill(Me.ItemStyleDataSet.ItemStyle)        Me.DestinationTableAdapter.Fill(Me.DestinationDataSet.Destination)        Me.ItemListTableAdapter.Fill(Me.ItemListLookupDataSet.ItemList, My.Settings.AccDepartmentId)        Me.SupplierTableAdapter.Fill(Me.SupplierDataSet.Supplier)        Me.UnitTableAdapter.Fill(Me.UnitDataSet.Unit)
        'Me.OrderLookupTableAdapter.FillByUserIdAndAcc(Me.OrderLookupDataSet.OrderLookup, UserId)
        Me.AccessoriesBookingNewDataSet.AccessoriesBooking.UserIdColumn.DefaultValue = UserId        Me.AccessoriesBookingNewDataSet.AccessoriesBooking.IPAddressColumn.DefaultValue = GetIPAddress()        OrderIdGridLookUpEdit.Properties.ReadOnly = True        If CheckUserRights("Accessories Booking").CanEdit = False Then            NewButton.Enabled = False            EditButton.Enabled = False            DeleteButton.Enabled = False            CancelEntryButton.Enabled = False        ElseIf CheckUserRights("Accessories Booking").CanDelete = False Then            NewButton.Enabled = True            EditButton.Enabled = True            DeleteButton.Enabled = False            CancelEntryButton.Enabled = False        End If    End Sub    Private Sub OrderIdGridLookUpEdit_EditValueChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles OrderIdGridLookUpEdit.EditValueChanged        On Error Resume Next        StyleLabel.Text = ReadStringData("Select StyleName From Style Where StyleId =(Select StyleId From [Order] Where OrderId=" & OrderIdGridLookUpEdit.EditValue & ")", cnn)        BuyerLabel.Text = ReadStringData("Select BuyerName From Buyer Where BuyerId =(Select BuyerId From [Order] Where OrderId=" & OrderIdGridLookUpEdit.EditValue & ")", cnn)        GMQtyTextEdit.Text = ReadData("select sum(OrderQuantity)  from OrderDetails where OrderId =" & OrderIdGridLookUpEdit.EditValue, cnn)        Me.OrderFabricColorTableAdapter.Fill(Me.OrderFabricColorDataSet.OrderFabricColor, Me.OrderIdGridLookUpEdit.EditValue)        Me.SizeLookupTableAdapter.Fill(Me.SizeDataSet.SizeLookup, Me.OrderIdGridLookUpEdit.EditValue)        Me.DestinationTableAdapter.FillByOrderId(Me.DestinationDataSet.Destination, Me.OrderIdGridLookUpEdit.EditValue)        Me.PackTypeLookupTableAdapter.Fill(Me.PackTypeByOrderDataSet.PackTypeLookup, Me.OrderIdGridLookUpEdit.EditValue)


    End Sub    Private Sub Save()        Me.Validate()        Me.AccessoriesBookingBindingSource.EndEdit()        Me.AccessoresBookingDetailsBindingSource.EndEdit()
        'Me.AccessoresBookingDetailsBindingSource.EndEdit()

        Me.TableAdapterManager.UpdateAll(Me.AccessoriesBookingNewDataSet)    End Sub    Private Sub ShowButton_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ShowButton.Click        NewButton.Text = "&New"        EditButton.Text = "&Edit"        EditButton.Enabled = True        Me.ProgramNoLookupByDivUserTableAdapter.Fill(Me.OrderLookupDataSet.ProgramNoLookupByDivUser, UserId)        Me.AccessoriesBookingTableAdapter.FillByAccBookingId(Me.AccessoriesBookingNewDataSet.AccessoriesBooking, ProgramSearchGridLookUpEdit.EditValue)        Me.AccessoresBookingDetailsTableAdapter.FillByAccBookingId(Me.AccessoriesBookingNewDataSet.AccessoresBookingDetails, ProgramSearchGridLookUpEdit.EditValue)        If Me.AccessoriesBookingBindingSource.Position = -1 Then            MessageBox.Show("Item Booking for this Program has not been found", "Booking Not Available", MessageBoxButtons.OK, MessageBoxIcon.Information)            Me.AccessoriesBookingNewDataSet.AccessoriesBooking.OrderIdColumn.DefaultValue = Me.ProgramSearchGridLookUpEdit.EditValue            Exit Sub        End If    End Sub    Private Sub ExportToXlsToolStripButton_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)

        'AddSizeColumn()


        'Declare a SaveFileDialog object






    End Sub    Private Sub AddSizeColumn()        Dim connection As New SqlConnection(cnn)        connection.Open()        Dim Size_cmd As SqlCommand = New SqlCommand("Select Distinct SizeId From OrderSizeDetails where OrderDetailsId in (Select OrderDetailsId From OrderDetails Where OrderId= " & OrderIdGridLookUpEdit.EditValue & ")", connection)        Dim Size_reader As SqlDataReader = Size_cmd.ExecuteReader()        Dim VisibleIndex As Integer = 4        Dim SizeCount As Integer = 0        While Size_reader.Read()

            'If GridView1.Columns(VisibleIndex).FieldName = "colSize" & Size_reader("SizeId") Then

            '    Dim SizeColumn2 As GridColumn = New GridColumn
            '    SizeColumn2 = 
            '    SizeColumn2.Dispose()



            'End If


            Dim SizeColumn As GridColumn = New GridColumn()            SizeColumn.FieldName = "colSize" & Size_reader("SizeId")            SizeColumn.Tag = "ubSizeColumn"            SizeColumn.Caption = ReadStringData("Select SizeCode From Size Where SizeId=" & Size_reader("SizeId"), cnn)
            'SizeColumn.UnboundType = DevExpress.Data.UnboundColumnType.Decimal
            'SizeColumn.UnboundExpression = "[Quantity] * [UnitPrice] * (1 - [Discount])"
            GridView1.Columns.Add(SizeColumn)            SizeColumn.VisibleIndex = VisibleIndex            VisibleIndex += 1        End While        Size_reader.Close()        connection.Close()    End Sub

    'Function GetGridViewColumnIndex(ByVal Columns As DataControlFieldCollection, ByVal DataColumnName As String) As Integer
    '    'this will find the gridview column index based on the underlying datafield for GridView BoundFields (not templates)
    '    'returns: -1 if it was unable to locate a match, otherwise the column index
    '    'example:
    '    '   Dim columnIndex as integer
    '    '   columnIndex = GetGridViewColumnIndex(Me.MyGridView.Columns, "MyDataColumnName")
    '    '   if columnIndex = -1 then
    '    '       'NOT FOUND
    '    '   else 
    '    '       'FOUND
    '    '       'this will get the value of that cell in the selected row:
    '    '       'Me.myGridView.SelectedRow.Cells(columnIndex).Text
    '    '   end if
    '    '
    '    Dim columnIndex As Integer = -1
    '    For Each field As DataControlField In Columns
    '        If TypeOf field Is System.Web.UI.WebControls.BoundField Then
    '            If CType(field, BoundField).DataField = DataColumnName Then
    '                columnIndex = Columns.IndexOf(field)
    '            End If
    '        End If
    '    Next

    '    Return columnIndex
    'End Function





    Private Sub Button1_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)        For i As Integer = 1 To 10            Dim SizeColumn As GridColumn = New GridColumn()            SizeColumn.Caption = i            SizeColumn.UnboundType = DevExpress.Data.UnboundColumnType.Decimal
            'columnExtPrice.UnboundExpression = "[Quantity] * [UnitPrice] * (1 - [Discount])"
            GridView1.Columns.Add(SizeColumn)
            'SizeColumn.VisibleIndex = 1

        Next    End Sub    Private Sub AmendmentDateDateEdit_EditValueChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles AmendmentDateDateEdit.EditValueChanged    End Sub    Private Sub ProgramSearchGridLookUpEdit_EditValueChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ProgramSearchGridLookUpEdit.EditValueChanged        On Error Resume Next        Me.SizeLookupTableAdapter.Fill(Me.SizeDataSet.SizeLookup, Me.OrderIdGridLookUpEdit.EditValue)        Me.OrderFabricColorTableAdapter.Fill(Me.OrderFabricColorDataSet.OrderFabricColor, Me.OrderIdGridLookUpEdit.EditValue)        Me.DestinationTableAdapter.FillByOrderId(Me.DestinationDataSet.Destination, Me.OrderIdGridLookUpEdit.EditValue)    End Sub    Private Sub GenerateAccBooking()        If Me.AccessoresBookingDetailsBindingSource.Position <> -1 Then            Exit Sub        End If        If Me.AccessoriesBookingBindingSource.Position > -1 Then            Dim row As AccessoriesBookingNewDataSet.AccessoriesBookingRow            row = CType(CType(Me.AccessoriesBookingBindingSource.Current, DataRowView).Row, AccessoriesBookingNewDataSet.AccessoriesBookingRow)            Dim MyStyleId As Integer = ReadIntegerData("Select Max(StyleId) From Style Where StyleName='" & StyleLabel.Text & "'", cnn)            Dim Acc_connection As New SqlConnection(cnn)            Acc_connection.Open()            Dim Acc_cmd As SqlCommand = New SqlCommand("Select ItemId,Consumption,IsSizewise,IsColorWise,IsPack,IsDestinationWise,ConUnitId,SupplierId,WastagePercentage,GarmentsQuantity,SLNO From StyleCapture_Accessories where StyleId=" & MyStyleId, Acc_connection)            Dim Acc_reader As SqlDataReader = Acc_cmd.ExecuteReader()            While Acc_reader.Read() 'Looping All Item Item

                Dim ConUnit As Integer = Acc_reader("ConUnitId")                Dim BookingUnit As Integer = ReadIntegerData("Select UnitId From ItemList Where ItemId=" & CInt(Acc_reader("ItemId").ToString), cnn)


                'Calcualate BookingConsumption

                Dim BuyerOrderQuantity As Integer                Dim BookingConsumption As Decimal                Dim ConversionValue As Decimal = ReadData("Select ConversionValue From UnitConversion Where FromUnitId=" & ConUnit & " And ToUnitId=" & BookingUnit, cnn)                Dim CalculateSign As String = ReadStringData("Select CalculateSign From UnitConversion Where FromUnitId=" & ConUnit & " And ToUnitId=" & BookingUnit, cnn)                Select Case CalculateSign                    Case "/"                        BookingConsumption = (Acc_reader("Consumption") / Acc_reader("GarmentsQuantity")) / ConversionValue                    Case "X"                        BookingConsumption = (Acc_reader("Consumption") / Acc_reader("GarmentsQuantity")) * ConversionValue                    Case "+"                        BookingConsumption = (Acc_reader("Consumption") / Acc_reader("GarmentsQuantity")) + ConversionValue                    Case "-"                        BookingConsumption = (Acc_reader("Consumption") / Acc_reader("GarmentsQuantity")) - ConversionValue                End Select




                'Checking Color

                If Acc_reader("IsColorWise") = True Then                    Dim Color_connection As New SqlConnection(cnn)                    If ConnectionState.Open Then                        Color_connection.Close()                    End If                    Color_connection.Open()                    Dim Color_cmd As SqlCommand = New SqlCommand("Select Distinct FabricColorId From vOrder Where OrderId=" & OrderIdGridLookUpEdit.EditValue, Color_connection)                    Dim Color_reader As SqlDataReader = Color_cmd.ExecuteReader()

                    'Adding New Row
                    While Color_reader.Read() 'Looping Color

                        If Acc_reader("IsSizewise") = True Then ' Color + Size

                            Dim Size_connection As New SqlConnection(cnn)                            Size_connection.Open()                            Dim Size_cmd As SqlCommand = New SqlCommand("Select Distinct SizeId From OrderSizeDetails where OrderDetailsId in (Select OrderDetailsId From OrderDetails Where OrderId= " & OrderIdGridLookUpEdit.EditValue & ")", Size_connection)                            Dim Size_reader As SqlDataReader = Size_cmd.ExecuteReader()                            While Size_reader.Read()                                Dim newRow As AccessoriesBookingNewDataSet.AccessoresBookingDetailsRow = Me.AccessoriesBookingNewDataSet.AccessoresBookingDetails.NewRow()                                newRow.FabricColorId = Color_reader("FabricColorId")                                newRow.ItemId = CInt(Acc_reader("ItemId").ToString)                                newRow.Consumption = CDec(Acc_reader("Consumption").ToString)                                newRow.ConsumptionUnitId = Acc_reader("ConUnitId")                                newRow.SizeId = CInt(Size_reader("SizeId").ToString())
                                'MessageBox.Show(Size_reader("SizeId").ToString())

                                BuyerOrderQuantity = ReadIntegerData("Select TTLOrderQuantity From OrderQuantitySummery_ColorAndSize Where OrderId=" & OrderIdGridLookUpEdit.EditValue & "And FabricColorId=" & Color_reader("FabricColorId").ToString & "And SizeId=" & Size_reader("SizeId"), cnn)                                newRow.OrderQuantity = BuyerOrderQuantity                                If ConUnit = BookingUnit Then

                                    'BookingQuantity = OrderQuantity / GarmentsQuantity * Consumption * (1 + WastagePercentage / 100)
                                    newRow.BookingQuantity = FormatNumber(BuyerOrderQuantity / Acc_reader("GarmentsQuantity"), 6) * FormatNumber(Acc_reader("Consumption"), 6) * (1 + FormatNumber(Acc_reader("WastagePercentage") / 100, 6))                                Else                                    newRow.BookingQuantity = FormatNumber(BuyerOrderQuantity / Acc_reader("GarmentsQuantity"), 6) * BookingConsumption * (1 + FormatNumber(Acc_reader("WastagePercentage") / 100, 6))                                End If                                newRow.BookingUnitId = ReadIntegerData("Select UnitId From ItemList Where ItemId=" & CInt(Acc_reader("ItemId").ToString), cnn)                                newRow.AccessoriesBookingId = row.AccessoriesBookingId                                newRow.SupplierId = Acc_reader("SupplierId").ToString                                newRow.WastagePercentage = Acc_reader("WastagePercentage").ToString                                newRow.ConsumptionForPcs = Acc_reader("GarmentsQuantity").ToString                                newRow.Remarks = "-"                                newRow.SLNo = Acc_reader("SlNo").ToString                                newRow.UnitPrice = ReadData("Select CurrentPrice From ItemList Where ItemId=" & Acc_reader("ItemId"), cnn)                                Me.AccessoriesBookingNewDataSet.AccessoresBookingDetails.Rows.Add(newRow)                            End While                            Size_reader.Close()                            Size_connection.Close()                        Else ' Color + Not Size

                            Dim newRow As AccessoriesBookingNewDataSet.AccessoresBookingDetailsRow = Me.AccessoriesBookingNewDataSet.AccessoresBookingDetails.NewRow()                            newRow.FabricColorId = Color_reader("FabricColorId")                            newRow.ItemId = CInt(Acc_reader("ItemId").ToString)                            newRow.Consumption = CDec(Acc_reader("Consumption").ToString)                            newRow.ConsumptionUnitId = Acc_reader("ConUnitId")                            BuyerOrderQuantity = ReadIntegerData("Select Sum(OrderQuantity) From [vOrder] Where OrderId=" & OrderIdGridLookUpEdit.EditValue & "And FabricColorId=" & Color_reader("FabricColorId").ToString, cnn)                            newRow.OrderQuantity = BuyerOrderQuantity                            If ConUnit = BookingUnit Then

                                'BookingQuantity = OrderQuantity / GarmentsQuantity * Consumption * (1 + WastagePercentage / 100)
                                newRow.BookingQuantity = FormatNumber(BuyerOrderQuantity / Acc_reader("GarmentsQuantity"), 6) * FormatNumber(Acc_reader("Consumption"), 6) * (1 + FormatNumber(Acc_reader("WastagePercentage") / 100, 6))                            Else                                newRow.BookingQuantity = FormatNumber(BuyerOrderQuantity / Acc_reader("GarmentsQuantity"), 6) * BookingConsumption * (1 + FormatNumber(Acc_reader("WastagePercentage") / 100, 6))                            End If                            newRow.BookingUnitId = ReadIntegerData("Select UnitId From ItemList Where ItemId=" & CInt(Acc_reader("ItemId").ToString), cnn)                            newRow.AccessoriesBookingId = row.AccessoriesBookingId                            newRow.SupplierId = Acc_reader("SupplierId").ToString                            newRow.WastagePercentage = Acc_reader("WastagePercentage").ToString                            newRow.ConsumptionForPcs = Acc_reader("GarmentsQuantity").ToString                            newRow.Remarks = "-"                            newRow.SLNo = Acc_reader("SlNo").ToString                            newRow.UnitPrice = ReadData("Select CurrentPrice From ItemList Where ItemId=" & Acc_reader("ItemId"), cnn)                            Me.AccessoriesBookingNewDataSet.AccessoresBookingDetails.Rows.Add(newRow)                        End If                    End While                    Color_reader.Close()                    Color_connection.Close()                Else 'Not Color + Not Size + ????

                    If Acc_reader("IsPack") = True Then                        Dim Pack_connection As New SqlConnection(cnn)                        Pack_connection.Open()                        Dim Pack_cmd As SqlCommand = New SqlCommand("Select Distinct PackType From OrderDetails where OrderId= " & OrderIdGridLookUpEdit.EditValue, Pack_connection)                        Dim Pack_reader As SqlDataReader = Pack_cmd.ExecuteReader()                        While Pack_reader.Read()                            If Acc_reader("IsDestinationWise") = True Then ' Not Color + Not Size + Pack + Destination


                                Dim Destination_connection As New SqlConnection(cnn)                                Destination_connection.Open()                                Dim Destination_cmd As SqlCommand = New SqlCommand("Select Distinct DestinationId From OrderDetails where OrderId= " & OrderIdGridLookUpEdit.EditValue, Destination_connection)                                Dim Destination_reader As SqlDataReader = Destination_cmd.ExecuteReader()                                While Destination_reader.Read()                                    Dim newRow As AccessoriesBookingNewDataSet.AccessoresBookingDetailsRow = Me.AccessoriesBookingNewDataSet.AccessoresBookingDetails.NewRow()                                    newRow.FabricColorId = Nothing                                    newRow.ItemId = CInt(Acc_reader("ItemId").ToString)                                    newRow.Consumption = CDec(Acc_reader("Consumption").ToString)                                    newRow.ConsumptionUnitId = Acc_reader("ConUnitId")                                    BuyerOrderQuantity = ReadIntegerData("Select Sum(OrderQuantity) From [vOrder] Where OrderId=" & OrderIdGridLookUpEdit.EditValue & "And PackType='" & Pack_reader("PackType") & "' And DestinationId=" & Destination_reader("DestinationId"), cnn)                                    newRow.OrderQuantity = BuyerOrderQuantity                                    If ConUnit = BookingUnit Then
                                        'BookingQuantity=OrderQuantity/GarmentsQuantity*Consumption * (1+WastagePercentage/100)

                                        If Acc_reader("GarmentsQuantity") > 0 Then                                            newRow.BookingQuantity = FormatNumber(BuyerOrderQuantity / Acc_reader("GarmentsQuantity"), 6) * FormatNumber(Acc_reader("Consumption"), 6) * (1 + FormatNumber(Acc_reader("WastagePercentage") / 100, 6))                                        Else                                            newRow.BookingQuantity = 0                                        End If                                    Else                                        newRow.BookingQuantity = FormatNumber(BuyerOrderQuantity / Acc_reader("GarmentsQuantity"), 6) * BookingConsumption * (1 + FormatNumber(Acc_reader("WastagePercentage") / 100, 6))                                    End If                                    newRow.BookingUnitId = Acc_reader("ConUnitId").ToString                                    newRow.AccessoriesBookingId = row.AccessoriesBookingId                                    newRow.SupplierId = Acc_reader("SupplierId").ToString                                    newRow.WastagePercentage = Acc_reader("WastagePercentage").ToString                                    newRow.ConsumptionForPcs = Acc_reader("GarmentsQuantity").ToString                                    newRow.Remarks = "-"                                    newRow.SLNo = Acc_reader("SlNo").ToString                                    newRow.UnitPrice = ReadData("Select CurrentPrice From ItemList Where ItemId=" & Acc_reader("ItemId"), cnn)                                    newRow.DestinationId = Destination_reader("DestinationId").ToString                                    newRow.PackType = Pack_reader("PackType").ToString                                    Me.AccessoriesBookingNewDataSet.AccessoresBookingDetails.Rows.Add(newRow)                                End While                                Destination_reader.Close()                                Destination_connection.Close()                            Else 'Not Color + Not Size + Pack + Not Desctination

                                Dim newRow As AccessoriesBookingNewDataSet.AccessoresBookingDetailsRow = Me.AccessoriesBookingNewDataSet.AccessoresBookingDetails.NewRow()                                newRow.FabricColorId = Nothing                                newRow.ItemId = CInt(Acc_reader("ItemId").ToString)                                newRow.Consumption = CDec(Acc_reader("Consumption").ToString)                                newRow.ConsumptionUnitId = Acc_reader("ConUnitId")                                BuyerOrderQuantity = ReadIntegerData("Select Sum(OrderQuantity) From [vOrder] Where OrderId=" & OrderIdGridLookUpEdit.EditValue & "And PackType='" & Pack_reader("PackType").ToString() & "'", cnn)                                newRow.OrderQuantity = BuyerOrderQuantity                                If ConUnit = BookingUnit Then
                                    'BookingQuantity=OrderQuantity/GarmentsQuantity*Consumption * (1+WastagePercentage/100)

                                    If Acc_reader("GarmentsQuantity") > 0 Then                                        newRow.BookingQuantity = FormatNumber(BuyerOrderQuantity / Acc_reader("GarmentsQuantity"), 6) * FormatNumber(Acc_reader("Consumption"), 6) * (1 + FormatNumber(Acc_reader("WastagePercentage") / 100, 6))                                    Else                                        newRow.BookingQuantity = 0                                    End If                                Else                                    newRow.BookingQuantity = FormatNumber(BuyerOrderQuantity / Acc_reader("GarmentsQuantity"), 6) * BookingConsumption * (1 + FormatNumber(Acc_reader("WastagePercentage") / 100, 6))                                End If                                newRow.BookingUnitId = Acc_reader("ConUnitId").ToString                                newRow.AccessoriesBookingId = row.AccessoriesBookingId                                newRow.SupplierId = Acc_reader("SupplierId").ToString                                newRow.WastagePercentage = Acc_reader("WastagePercentage").ToString                                newRow.ConsumptionForPcs = Acc_reader("GarmentsQuantity").ToString                                newRow.Remarks = "-"                                newRow.SLNo = Acc_reader("SlNo").ToString                                newRow.UnitPrice = ReadData("Select CurrentPrice From ItemList Where ItemId=" & Acc_reader("ItemId"), cnn)
                                'newRow.DestinationId = Destination_reader("DestinationId").ToString
                                newRow.PackType = Pack_reader("PackType").ToString                                Me.AccessoriesBookingNewDataSet.AccessoresBookingDetails.Rows.Add(newRow)                            End If                        End While                    Else ' Not Color + Not Size + (Destination/Not Destination)+Not Pack + 

                        If Acc_reader("IsDestinationWise") = True Then ' Not Color + Not Size + Destination + Not Pack

                            Dim Destination_connection As New SqlConnection(cnn)                            Destination_connection.Open()                            Dim Destination_cmd As SqlCommand = New SqlCommand("Select Distinct DestinationId From OrderDetails where OrderId= " & OrderIdGridLookUpEdit.EditValue, Destination_connection)                            Dim Destination_reader As SqlDataReader = Destination_cmd.ExecuteReader()                            While Destination_reader.Read()                                Dim newRow As AccessoriesBookingNewDataSet.AccessoresBookingDetailsRow = Me.AccessoriesBookingNewDataSet.AccessoresBookingDetails.NewRow()                                newRow.FabricColorId = Nothing                                newRow.ItemId = CInt(Acc_reader("ItemId").ToString)                                newRow.Consumption = CDec(Acc_reader("Consumption").ToString)                                newRow.ConsumptionUnitId = Acc_reader("ConUnitId")                                BuyerOrderQuantity = ReadIntegerData("Select Sum(OrderQuantity) From [vOrder] Where OrderId=" & OrderIdGridLookUpEdit.EditValue & "And DestinationId=" & Destination_reader("DestinationId"), cnn)                                newRow.OrderQuantity = BuyerOrderQuantity                                If ConUnit = BookingUnit Then
                                    'BookingQuantity=OrderQuantity/GarmentsQuantity*Consumption * (1+WastagePercentage/100)

                                    If Acc_reader("GarmentsQuantity") > 0 Then                                        newRow.BookingQuantity = FormatNumber(BuyerOrderQuantity / Acc_reader("GarmentsQuantity"), 6) * FormatNumber(Acc_reader("Consumption"), 6) * (1 + FormatNumber(Acc_reader("WastagePercentage") / 100, 6))                                    Else                                        newRow.BookingQuantity = 0                                    End If                                Else                                    newRow.BookingQuantity = FormatNumber(BuyerOrderQuantity / Acc_reader("GarmentsQuantity"), 6) * BookingConsumption * (1 + FormatNumber(Acc_reader("WastagePercentage") / 100, 6))                                End If                                newRow.BookingUnitId = Acc_reader("ConUnitId").ToString                                newRow.AccessoriesBookingId = row.AccessoriesBookingId                                newRow.SupplierId = Acc_reader("SupplierId").ToString                                newRow.WastagePercentage = Acc_reader("WastagePercentage").ToString                                newRow.ConsumptionForPcs = Acc_reader("GarmentsQuantity").ToString                                newRow.Remarks = "-"                                newRow.SLNo = Acc_reader("SlNo").ToString                                newRow.UnitPrice = ReadData("Select CurrentPrice From ItemList Where ItemId=" & Acc_reader("ItemId"), cnn)                                newRow.DestinationId = Destination_reader("DestinationId").ToString
                                'newRow.PackType = Pack_reader("PackType").ToString

                                Me.AccessoriesBookingNewDataSet.AccessoresBookingDetails.Rows.Add(newRow)                            End While                            Destination_reader.Close()                            Destination_connection.Close()                        Else ' Not Color + Not Size + Not Pack + Not Destination

                            Dim newRow As AccessoriesBookingNewDataSet.AccessoresBookingDetailsRow = Me.AccessoriesBookingNewDataSet.AccessoresBookingDetails.NewRow()                            newRow.FabricColorId = Nothing                            newRow.ItemId = CInt(Acc_reader("ItemId").ToString)                            newRow.Consumption = CDec(Acc_reader("Consumption").ToString)                            newRow.ConsumptionUnitId = Acc_reader("ConUnitId")                            BuyerOrderQuantity = ReadIntegerData("Select Sum(OrderQuantity) From [vOrder] Where OrderId=" & OrderIdGridLookUpEdit.EditValue, cnn)                            newRow.OrderQuantity = BuyerOrderQuantity                            If ConUnit = BookingUnit Then
                                'BookingQuantity=OrderQuantity/GarmentsQuantity*Consumption * (1+WastagePercentage/100)

                                If Acc_reader("GarmentsQuantity") > 0 Then                                    newRow.BookingQuantity = FormatNumber(BuyerOrderQuantity / Acc_reader("GarmentsQuantity"), 6) * FormatNumber(Acc_reader("Consumption"), 6) * (1 + FormatNumber(Acc_reader("WastagePercentage") / 100, 6))                                Else                                    newRow.BookingQuantity = 0                                End If                            Else                                newRow.BookingQuantity = FormatNumber(BuyerOrderQuantity / Acc_reader("GarmentsQuantity"), 6) * BookingConsumption * (1 + FormatNumber(Acc_reader("WastagePercentage") / 100, 6))                            End If                            newRow.BookingUnitId = Acc_reader("ConUnitId").ToString                            newRow.AccessoriesBookingId = row.AccessoriesBookingId                            newRow.SupplierId = Acc_reader("SupplierId").ToString                            newRow.WastagePercentage = Acc_reader("WastagePercentage").ToString                            newRow.ConsumptionForPcs = Acc_reader("GarmentsQuantity").ToString                            newRow.Remarks = "-"                            newRow.SLNo = Acc_reader("SlNo").ToString                            newRow.UnitPrice = ReadData("Select CurrentPrice From ItemList Where ItemId=" & Acc_reader("ItemId"), cnn)                            Me.AccessoriesBookingNewDataSet.AccessoresBookingDetails.Rows.Add(newRow)                        End If                    End If                End If            End While            Acc_reader.Close()            Acc_connection.Close()        End If    End Sub    Private Sub Saved()        Try            Me.Validate()            Me.AccessoriesBookingBindingSource.EndEdit()            Me.AccessoresBookingDetailsBindingSource.EndEdit()            Me.AccessoriesBookingCareLableBindingSource.EndEdit()            Me.TableAdapterManager.UpdateAll(Me.AccessoriesBookingNewDataSet)            If Me.AccessoriesBookingBindingSource.Position > -1 Then                If IsCompleteCheckEdit.Checked Then                    ExecuteQuery("Update [Order] Set IsAccBOMComplete=1 Where OrderId=" & OrderIdGridLookUpEdit.EditValue, cnn)                ElseIf IsCompleteCheckEdit.Checked = False Then                    ExecuteQuery("Update [Order] Set IsAccBOMComplete=0 Where OrderId=" & OrderIdGridLookUpEdit.EditValue, cnn)                End If            End If


            'Me.OrderLookup1TableAdapter.Fill(Me.OrderLookupDataSet.OrderLookup1)
            'Me.AccOrderLookupTableAdapter.Fill(Me.AccessoriesBookingNewDataSet.AccOrderLookup)

        Catch ex As Exception            MessageBox.Show(ex.Message)        End Try

    End Sub    Private Sub DestinationCheckBox_CheckedChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles DestinationCheckBox.CheckedChanged        If DestinationCheckBox.Checked Then            ColorCheckBox.Checked = False            SizeCheckBox.Checked = False            PackCheckBox.Checked = False        End If        If Me.DestinationBindingSource.Position > -1 Then            If DestinationCheckBox.Checked Then                For i As Integer = 0 To DestinationBindingSource.Count - 1                    DestinationCheckedListBox.SetItemChecked(i, True)                Next            Else                For i As Integer = 0 To DestinationBindingSource.Count - 1                    DestinationCheckedListBox.SetItemChecked(i, False)                Next            End If        End If    End Sub    Private Sub ColorCheckBox_CheckedChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ColorCheckBox.CheckedChanged        If ColorCheckBox.Checked Then            DestinationCheckBox.Checked = False            PackCheckBox.Checked = False        End If        If ColorCheckBox.Checked Then            For i As Integer = 0 To OrderFabricColorBindingSource.Count - 1                ColorCheckListBox.SetItemChecked(i, True)            Next        Else            For i As Integer = 0 To OrderFabricColorBindingSource.Count - 1                ColorCheckListBox.SetItemChecked(i, False)            Next        End If


    End Sub    Private Sub AccNameGridLookUpEdit_EditValueChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles AccNameGridLookUpEdit.EditValueChanged

        'ColorCheckBox.Checked = ReadBooleanData("Select IsColorWise From ItemList Where ItemId=" & AccNameGridLookUpEdit.EditValue, cnn)
        'SizeCheckBox.Checked = ReadBooleanData("Select IsSizeWise From ItemList Where ItemId=" & AccNameGridLookUpEdit.EditValue, cnn)
        'PackCheckBox.Checked = ReadBooleanData("Select IsPack From ItemList Where ItemId=" & AccNameGridLookUpEdit.EditValue, cnn)
        'DestinationCheckBox.Checked = ReadBooleanData("Select IsDestinationWise From ItemList Where ItemId=" & AccNameGridLookUpEdit.EditValue, cnn)

    End Sub




    Private Sub PrintButton_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles PrintButton.Click        With frmAccessoriesBookingPrint            .OID = Me.OrderIdGridLookUpEdit.EditValue            .MdiParent = frmMain            .WindowState = FormWindowState.Maximized            .Show()        End With    End Sub    Private Sub NewButton_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles NewButton.Click        If NewButton.Text = "&New" Then            EnableFormControl(Me)            GenerateButton.Enabled = False            AddFlag = True            OrderIdGridLookUpEdit.Properties.ReadOnly = False            NewButton.Text = "&Save"            EditButton.Enabled = False            CancelEntryButton.Enabled = True            OrderIdGridLookUpEdit.Properties.ReadOnly = False
            'Me.OrderLookup1TableAdapter.FillByAccBOMPending(Me.OrderLookupDataSet.OrderLookup1, UserId)
            Me.ProgramNoLookupByDivUserTableAdapter.FillByAccBOMPending(Me.OrderLookupDataSet.ProgramNoLookupByDivUser, UserId)            AccessoriesBookingBindingSource.AddNew()        ElseIf NewButton.Text = "&Save" Then            DisableFromControl(Me)            NewButton.Text = "&New"            AddFlag = False            OrderIdGridLookUpEdit.Properties.ReadOnly = True            EditButton.Enabled = True            CancelEntryButton.Enabled = False

            'Saving And Generating Item Booking Details

            Saved()            If Me.AccessoriesBookingBindingSource.Position > -1 Then                Me.AccBookingLookupTableAdapter.FillByUserId(Me.AccBOMLookUpDataSet.AccBookingLookup, UserId)                Dim row As AccessoriesBookingNewDataSet.AccessoriesBookingRow                row = CType(CType(Me.AccessoriesBookingBindingSource.Current, DataRowView).Row, AccessoriesBookingNewDataSet.AccessoriesBookingRow)                Me.ProgramSearchGridLookUpEdit.EditValue = row.AccessoriesBookingId            End If            GenerateButton.Enabled = True            OrderIdGridLookUpEdit.Properties.ReadOnly = True
            'GenerateAccBooking()

            'If AccessoriesBookingNewDataSet.HasChanges Then

            '    Saved()

            'End If



        End If    End Sub    Private Sub EditButton_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles EditButton.Click        If IsCompleteCheckEdit.Checked = True Then            MessageBox.Show("Not allowed ,need amendment.", "Message")            Exit Sub        End If        If EditButton.Text = "&Edit" Then            EnableFormControl(Me)            EditButton.Text = "&Update"            NewButton.Enabled = False            CancelEntryButton.Enabled = True            GenerateButton.Enabled = True        Else

            'If AccessoriesBookingNewDataSet.HasChanges Then
            If Me.AccessoresBookingDetailsBindingSource.Position > -1 Then                If CheckFullComplete() = True Then                    IsCompleteCheckEdit.Checked = True                Else                    IsCompleteCheckEdit.Checked = False                End If            End If            Saved()

            'End If

            'Saveing/Updating...

            DisableFromControl(Me)            EditButton.Text = "&Edit"            NewButton.Enabled = True            CancelEntryButton.Enabled = False            GenerateButton.Enabled = False        End If    End Sub    Private Sub DeleteButton_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles DeleteButton.Click        If Me.AccessoresBookingDetailsBindingSource.Position = -1 Then            If MessageBox.Show("Are you sure you wanted to delete the Item BOM ?", "Acc BOM Deleting", MessageBoxButtons.OKCancel, MessageBoxIcon.Question) = System.Windows.Forms.DialogResult.OK Then                AccessoriesBookingBindingSource.RemoveCurrent()                If AccessoriesBookingNewDataSet.HasChanges Then                    Saved()                    MessageBox.Show("Acc BOM has been deleted successfully", "Buyer Order", MessageBoxButtons.OK, MessageBoxIcon.Information)                End If            Else                Exit Sub            End If        Else            MessageBox.Show("Unable to Delete. Remove Details first.", "Buyer Order", MessageBoxButtons.OK, MessageBoxIcon.Information)        End If    End Sub    Private Sub CancelEntryButton_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles CancelEntryButton.Click        DisableFromControl(Me)        NewButton.Enabled = True        NewButton.Text = "&New"        EditButton.Enabled = True        EditButton.Text = "&Edit"        CancelEntryButton.Enabled = False    End Sub    Private Sub Button1_Click_1(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button1.Click        Dim objSaveFileDialog As New SaveFileDialog

        'Set the Save dialog properties
        With objSaveFileDialog            .DefaultExt = "xls"            .FileName = "ACC-" & OrderIdGridLookUpEdit.Text            .Filter = "Excel files (*.xls)|*.xls|All files (*.*)|*.*"            .FilterIndex = 1            .OverwritePrompt = True            .Title = "Save File Dialog"        End With

        'Show the Save dialog and if the user clicks the Save button,
        'save the file
        If objSaveFileDialog.ShowDialog = System.Windows.Forms.DialogResult.OK Then            Try                GridView1.ExportToXls(objSaveFileDialog.FileName)
                'MessageBox.Show("Exported to ""C:\Order Booking.xls"" Successfully", "Export", MessageBoxButtons.OK, MessageBoxIcon.Information)

            Catch ex As Exception                MessageBox.Show(ex.Message)            End Try        End If

        'Clean up
        objSaveFileDialog.Dispose()        objSaveFileDialog = Nothing    End Sub    Private Sub GridView1_CellValueChanged(ByVal sender As System.Object, ByVal e As DevExpress.XtraGrid.Views.Base.CellValueChangedEventArgs) Handles GridView1.CellValueChanged        Recalculate()    End Sub    Private Sub Recalculate()        On Error Resume Next        Dim row As AccessoriesBookingNewDataSet.AccessoresBookingDetailsRow        row = CType(CType(Me.AccessoresBookingDetailsBindingSource.Current, DataRowView).Row, AccessoriesBookingNewDataSet.AccessoresBookingDetailsRow)        If row.IsApproved = True Then            Exit Sub        End If
        'Calcualate BookingConsumption

        Dim BuyerOrderQuantity As Integer = row.OrderQuantity        Dim BookingConsumption As Decimal        Dim ConUnit As Integer = row.ConsumptionUnitId        Dim BookingUnit As Integer = row.BookingUnitId        Dim ConversionValue As Decimal = ReadData("Select ConversionValue From UnitConversion Where FromUnitId=" & ConUnit & " And ToUnitId=" & BookingUnit, cnn)        Dim CalculateSign As String = ReadStringData("Select CalculateSign From UnitConversion Where FromUnitId=" & ConUnit & " And ToUnitId=" & BookingUnit, cnn)        Select Case CalculateSign            Case "/"                BookingConsumption = (row.Consumption) / ConversionValue            Case "X"                BookingConsumption = (row.Consumption) * ConversionValue            Case "+"                BookingConsumption = (row.Consumption) + ConversionValue            Case "-"                BookingConsumption = (row.Consumption) - ConversionValue        End Select        If ConUnit = BookingUnit Then

            'BookingQuantity=OrderQuantity/GarmentsQuantity*Consumption * (1+WastagePercentage/100)

            If row.ConsumptionForPcs > 0 Then                row.BookingQuantity = FormatNumber(BuyerOrderQuantity / row.ConsumptionForPcs, 6) * FormatNumber(row.Consumption, 6) * (1 + FormatNumber(row.WastagePercentage / 100, 6))            Else                row.BookingQuantity = 0            End If        Else            row.BookingQuantity = FormatNumber(BuyerOrderQuantity / row.ConsumptionForPcs, 6) * BookingConsumption * (1 + FormatNumber(row.WastagePercentage / 100, 6))        End If        If row.AdditionalQuantity > 0 Then            row.BookingQuantity = row.BookingQuantity + row.AdditionalQuantity        End If    End Sub    Private Sub Button3_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles GenByStyleButton.Click        GenerateAccBooking()    End Sub    Private Sub GenerateButton_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles GenerateButton.Click        GenerateAccBookingByItem()    End Sub    Private Sub GenerateAccBookingByItem()        If ConSpinEdit.Value = 0 Then            MessageBox.Show("Consumption Data Missing")            Exit Sub        ElseIf UnitIdGridLookUpEdit.EditValue = -1 Then            MessageBox.Show("Consumption Unit Data Missing ")            Exit Sub        ElseIf ConPCSSpinEdit.Value = 0 Then            MessageBox.Show("Consumption for Garments Data Missing ")            Exit Sub        End If        If Me.AccessoriesBookingBindingSource.Position > -1 Then            Dim row As AccessoriesBookingNewDataSet.AccessoriesBookingRow            row = CType(CType(Me.AccessoriesBookingBindingSource.Current, DataRowView).Row, AccessoriesBookingNewDataSet.AccessoriesBookingRow)            Dim Acc_connection As New SqlConnection(cnn)            Acc_connection.Open()            Dim Acc_cmd As SqlCommand = New SqlCommand("Select ItemId,UnitId," & Me.WPercSpinEdit.Value & "As WastagePercentage From ItemList where ItemId=" & Me.AccNameGridLookUpEdit.EditValue, Acc_connection)            Dim Acc_reader As SqlDataReader = Acc_cmd.ExecuteReader()            While Acc_reader.Read() 'Looping All Item Item

                Dim ConUnit As Integer = UnitIdGridLookUpEdit.EditValue                Dim BookingUnit As Integer                If Acc_reader("UnitId").ToString = "" Then                    MessageBox.Show("Unit is missing in Item List")                    Exit Sub                Else                    BookingUnit = CInt(Acc_reader("UnitId").ToString)                End If



                'Calcualate BookingConsumption


                Dim BookingConsumption As Decimal                Dim ConversionValue As Decimal = ReadData("Select ConversionValue From UnitConversion Where FromUnitId=" & ConUnit & " And ToUnitId=" & BookingUnit, cnn)                Dim CalculateSign As String = ReadStringData("Select CalculateSign From UnitConversion Where FromUnitId=" & ConUnit & " And ToUnitId=" & BookingUnit, cnn)                Select Case CalculateSign                    Case "/"                        BookingConsumption = ConSpinEdit.EditValue / ConversionValue                    Case "X"                        BookingConsumption = ConSpinEdit.EditValue * ConversionValue                    Case "+"                        BookingConsumption = ConSpinEdit.EditValue + ConversionValue                    Case "-"                        BookingConsumption = ConSpinEdit.EditValue - ConversionValue                End Select                If ColorCheckBox.Checked = True AndAlso SizeCheckBox.Checked = False AndAlso PackCheckBox.Checked = False AndAlso DestinationCheckBox.Checked = False Then 'Color

                    GenByColor(Acc_reader, ConUnit, BookingUnit, BookingConsumption, row.AccessoriesBookingId)                ElseIf ColorCheckBox.Checked = True AndAlso SizeCheckBox.Checked = True AndAlso PackCheckBox.Checked = False AndAlso DestinationCheckBox.Checked = False Then 'Color And Size

                    GenByColorAndSize(Acc_reader, ConUnit, BookingUnit, BookingConsumption, row.AccessoriesBookingId)                ElseIf ColorCheckBox.Checked = False AndAlso SizeCheckBox.Checked = True AndAlso PackCheckBox.Checked = False AndAlso DestinationCheckBox.Checked = False Then 'Size

                    GenBySize(Acc_reader, ConUnit, BookingUnit, BookingConsumption, row.AccessoriesBookingId)                ElseIf ColorCheckBox.Checked = False AndAlso SizeCheckBox.Checked = False AndAlso PackCheckBox.Checked = True AndAlso DestinationCheckBox.Checked = False Then 'Pack

                    GenByPack(Acc_reader, ConUnit, BookingUnit, BookingConsumption, row.AccessoriesBookingId)                ElseIf ColorCheckBox.Checked = False AndAlso SizeCheckBox.Checked = False AndAlso PackCheckBox.Checked = False AndAlso DestinationCheckBox.Checked = True Then 'Destination

                    GenByDestination(Acc_reader, ConUnit, BookingUnit, BookingConsumption, row.AccessoriesBookingId)                ElseIf ColorCheckBox.Checked = False AndAlso SizeCheckBox.Checked = False AndAlso PackCheckBox.Checked = False AndAlso DestinationCheckBox.Checked = False Then 'All

                    GenByAll(Acc_reader, ConUnit, BookingUnit, BookingConsumption, row.AccessoriesBookingId)                End If


            End While            Acc_reader.Close()            Acc_connection.Close()        End If    End Sub    Private Function ColorIdCollection() As String        Dim CIC As String = ""        For index As Integer = 0 To ColorCheckListBox.CheckedItems.Count - 1            If CIC = "" Then                CIC = ColorCheckListBox.CheckedItems(index)            Else                CIC = CIC & "," & ColorCheckListBox.CheckedItems(index)            End If        Next        Return CIC    End Function    Private Function SizeIdCollection() As String        Dim CIC As String = ""        For index As Integer = 0 To SizeCheckListBox.CheckedItems.Count - 1            If CIC = "" Then                CIC = SizeCheckListBox.CheckedItems(index)            Else                CIC = CIC & "," & SizeCheckListBox.CheckedItems(index)            End If        Next        Return CIC    End Function    Private Function DestinationCollection() As String        Dim CIC As String = ""        For index As Integer = 0 To DestinationCheckedListBox.CheckedItems.Count - 1            If CIC = "" Then                CIC = DestinationCheckedListBox.CheckedItems(index)            Else                CIC = CIC & "," & DestinationCheckedListBox.CheckedItems(index)            End If        Next        Return CIC    End Function    Private Function PackTypeCollection() As String        Dim CIC As String = ""        For index As Integer = 0 To PackCheckListBox.CheckedItems.Count - 1            If CIC = "" Then                CIC = PackCheckListBox.CheckedItems(index)            Else                CIC = CIC & "','" & PackCheckListBox.CheckedItems(index)            End If        Next        Return CIC    End Function    Private Sub SizeCheckBox_CheckedChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles SizeCheckBox.CheckedChanged        If SizeCheckBox.Checked Then            DestinationCheckBox.Checked = False            PackCheckBox.Checked = False        End If        If SizeCheckBox.Checked Then            For i As Integer = 0 To SizeLookupBindingSource.Count - 1                SizeCheckListBox.SetItemChecked(i, True)            Next        Else            For i As Integer = 0 To SizeLookupBindingSource.Count - 1                SizeCheckListBox.SetItemChecked(i, False)            Next        End If    End Sub




    Private Sub AccessoresBookingDetailsGridControl_KeyDown(ByVal sender As Object, ByVal e As System.Windows.Forms.KeyEventArgs) Handles AccessoresBookingDetailsGridControl.KeyDown        If e.KeyData = Keys.F11 Then            If AccessoresBookingDetailsGridControl.IsFocused Then                If GridView1.FocusedColumn.AbsoluteIndex = colFabricColorId.AbsoluteIndex Then                    frmFabricColor.ShowDialog()                End If            End If        End If    End Sub    Private Sub AccLinkLabel_LinkClicked(ByVal sender As System.Object, ByVal e As System.Windows.Forms.LinkLabelLinkClickedEventArgs) Handles AccLinkLabel.LinkClicked        frmAccItemList.BuyerId = ReadIntegerData("Select BuyerId From [Order] Where OrderId=" & OrderIdGridLookUpEdit.EditValue, cnn)        ShowMaster(frmAccItemList)        If frmAccItemList.DialogResult = System.Windows.Forms.DialogResult.OK Then            Me.ItemListTableAdapter.Fill(Me.ItemListLookupDataSet.ItemList, My.Settings.AccDepartmentId)            Me.AccNameGridLookUpEdit.EditValue = frmAccItemList.ItemID        End If    End Sub    Private Sub IsCompleteCheckEdit_CheckedChanged(ByVal sender As System.Object, ByVal e As System.EventArgs)

        'FabricBookingDateDateEdit.EditValue = Today()

        If IsCompleteCheckEdit.Checked = False Then            Exit Sub        End If        If EditButton.Text = "&Update" Then            If AmendmentNoSpinEdit.Value = 0 Then                Dim SToday As Date = ReadDateData("Select GetDate()", cnn)                BookingDateDateEdit.EditValue = SToday            Else                Dim SToday As Date = ReadDateData("Select GetDate()", cnn)                AmendmentDateDateEdit.EditValue = SToday            End If        End If    End Sub    Private Sub PackCheckBox_CheckedChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles PackCheckBox.CheckedChanged        If PackCheckBox.Checked Then            ColorCheckBox.Checked = False            SizeCheckBox.Checked = False            DestinationCheckBox.Checked = False        End If        If Me.PackCheckListBox.Items.Count > -1 Then            If PackCheckBox.Checked Then                For i As Integer = 0 To PackCheckListBox.Items.Count - 1                    PackCheckListBox.SetItemChecked(i, True)                Next            Else                For i As Integer = 0 To PackCheckListBox.Items.Count - 1                    PackCheckListBox.SetItemChecked(i, False)                Next            End If        End If    End Sub    Private Sub SelectAllColorLinkLabel_LinkClicked(ByVal sender As System.Object, ByVal e As System.Windows.Forms.LinkLabelLinkClickedEventArgs) Handles SelectAllColorLinkLabel.LinkClicked        For i As Integer = 0 To OrderFabricColorBindingSource.Count - 1            ColorCheckListBox.SetItemChecked(i, False)        Next    End Sub    Private Sub SelectAllSizeLinkLabel_LinkClicked(ByVal sender As System.Object, ByVal e As System.Windows.Forms.LinkLabelLinkClickedEventArgs) Handles SelectAllSizeLinkLabel.LinkClicked        For i As Integer = 0 To SizeLookupBindingSource.Count - 1            SizeCheckListBox.SetItemChecked(i, False)        Next    End Sub    Private Sub GenByColor(ByVal Acc_Reader As SqlDataReader, ByVal ConUnit As Integer, ByVal BookingUnit As Integer, ByVal BookingConsumption As Decimal, ByVal AccBoolingId As Integer)        Dim Color_connection As New SqlConnection(cnn)        If ConnectionState.Open Then            Color_connection.Close()        End If        Color_connection.Open()
        'Dim Color_cmd As SqlCommand = New SqlCommand("Select Distinct FabricColorId From vOrder Where OrderId=" & OrderIdGridLookUpEdit.EditValue, Color_connection)
        Dim Color_cmd As SqlCommand = New SqlCommand("Select Distinct FabricColorId From vOrder Where OrderId=" & OrderIdGridLookUpEdit.EditValue & "And FabricColorId in (" & ColorIdCollection() & ")", Color_connection)        Dim Color_reader As SqlDataReader = Color_cmd.ExecuteReader()        While Color_reader.Read() 'Looping Color

            Dim newRow As AccessoriesBookingNewDataSet.AccessoresBookingDetailsRow = Me.AccessoriesBookingNewDataSet.AccessoresBookingDetails.NewRow()            newRow.FabricColorId = Color_reader("FabricColorId")            newRow.ItemId = CInt(Acc_Reader("ItemId").ToString)            newRow.Consumption = ConSpinEdit.EditValue            newRow.ConsumptionUnitId = UnitIdGridLookUpEdit.EditValue            Dim BuyerOrderQuantity As Decimal = ReadIntegerData("Select Sum(OrderQuantity) From [vOrder] Where OrderId=" & OrderIdGridLookUpEdit.EditValue & "And FabricColorId=" & Color_reader("FabricColorId").ToString, cnn)            newRow.OrderQuantity = BuyerOrderQuantity            If ConUnit = BookingUnit Then

                'BookingQuantity = OrderQuantity / GarmentsQuantity * Consumption * (1 + WastagePercentage / 100)
                newRow.BookingQuantity = FormatNumber(BuyerOrderQuantity / ConPCSSpinEdit.EditValue, 6) * FormatNumber(ConSpinEdit.EditValue, 6) * (1 + FormatNumber(Acc_Reader("WastagePercentage") / 100, 6))            Else                newRow.BookingQuantity = FormatNumber(BuyerOrderQuantity / ConPCSSpinEdit.EditValue, 6) * BookingConsumption * (1 + FormatNumber(Acc_Reader("WastagePercentage") / 100, 6))            End If            newRow.BookingUnitId = Int(Acc_Reader("UnitId").ToString)            newRow.AccessoriesBookingId = AccBoolingId
            'newRow.SupplierId = Acc_reader("SupplierId").ToString
            newRow.WastagePercentage = Acc_Reader("WastagePercentage").ToString            newRow.ConsumptionForPcs = ConPCSSpinEdit.EditValue            newRow.Remarks = "-"
            'newRow.SLNo = Acc_reader("SlNo").ToString
            newRow.UnitPrice = ReadData("Select CurrentPrice From ItemList Where ItemId=" & Acc_Reader("ItemId"), cnn)            newRow.GenerationType = "GenByColor"            Me.AccessoriesBookingNewDataSet.AccessoresBookingDetails.Rows.Add(newRow)        End While        Color_reader.Close()        Color_connection.Close()    End Sub    Private Sub GenByColorAndSize(ByVal Acc_Reader As SqlDataReader, ByVal ConUnit As Integer, ByVal BookingUnit As Integer, ByVal BookingConsumption As Decimal, ByVal AccBoolingId As Integer)        Dim Color_connection As New SqlConnection(cnn)        If ConnectionState.Open Then            Color_connection.Close()        End If        Color_connection.Open()
        'Dim Color_cmd As SqlCommand = New SqlCommand("Select Distinct FabricColorId From vOrder Where OrderId=" & OrderIdGridLookUpEdit.EditValue, Color_connection)
        Dim Color_cmd As SqlCommand = New SqlCommand("Select Distinct FabricColorId From vOrder Where OrderId=" & OrderIdGridLookUpEdit.EditValue & "And FabricColorId in (" & ColorIdCollection() & ")", Color_connection)        Dim Color_reader As SqlDataReader = Color_cmd.ExecuteReader()

        'Adding New Row
        While Color_reader.Read() 'Looping Color


            Dim Size_connection As New SqlConnection(cnn)            Size_connection.Open()            Dim Size_cmd As SqlCommand = New SqlCommand("Select Distinct SizeId From OrderSizeDetails where OrderDetailsId in (Select OrderDetailsId From OrderDetails Where OrderId= " & OrderIdGridLookUpEdit.EditValue & ") And SizeId in (" & SizeIdCollection() & ")", Size_connection)            Dim Size_reader As SqlDataReader = Size_cmd.ExecuteReader()            While Size_reader.Read()                Dim newRow As AccessoriesBookingNewDataSet.AccessoresBookingDetailsRow = Me.AccessoriesBookingNewDataSet.AccessoresBookingDetails.NewRow()                newRow.FabricColorId = Color_reader("FabricColorId")                newRow.ItemId = CInt(Acc_Reader("ItemId").ToString)                newRow.Consumption = ConSpinEdit.EditValue                newRow.ConsumptionUnitId = UnitIdGridLookUpEdit.EditValue                newRow.SizeId = CInt(Size_reader("SizeId").ToString())
                'MessageBox.Show(Size_reader("SizeId").ToString())

                Dim BuyerOrderQuantity As Decimal = ReadIntegerData("Select TTLOrderQuantity From OrderQuantitySummery_ColorAndSize Where OrderId=" & OrderIdGridLookUpEdit.EditValue & "And FabricColorId=" & Color_reader("FabricColorId").ToString & "And SizeId=" & Size_reader("SizeId"), cnn)                newRow.OrderQuantity = BuyerOrderQuantity                If ConUnit = BookingUnit Then

                    'BookingQuantity = OrderQuantity / GarmentsQuantity * Consumption * (1 + WastagePercentage / 100)
                    newRow.BookingQuantity = FormatNumber(BuyerOrderQuantity / ConPCSSpinEdit.EditValue, 6) * FormatNumber(ConSpinEdit.EditValue, 6) * (1 + FormatNumber(Acc_Reader("WastagePercentage") / 100, 6))                Else                    newRow.BookingQuantity = FormatNumber(BuyerOrderQuantity / ConPCSSpinEdit.EditValue, 6) * BookingConsumption * (1 + FormatNumber(Acc_Reader("WastagePercentage") / 100, 6))                End If                newRow.BookingUnitId = Acc_Reader("UnitId").ToString                newRow.AccessoriesBookingId = AccBoolingId
                'newRow.SupplierId = Acc_reader("SupplierId").ToString
                newRow.WastagePercentage = Acc_Reader("WastagePercentage").ToString                newRow.ConsumptionForPcs = ConPCSSpinEdit.EditValue.ToString                newRow.Remarks = "-"
                'newRow.SLNo = Acc_reader("SlNo").ToString
                newRow.UnitPrice = ReadData("Select CurrentPrice From ItemList Where ItemId=" & Acc_Reader("ItemId"), cnn)                newRow.GenerationType = "GenByColorAndSize"                Me.AccessoriesBookingNewDataSet.AccessoresBookingDetails.Rows.Add(newRow)            End While            Size_reader.Close()            Size_connection.Close()        End While        Color_reader.Close()        Color_connection.Close()    End Sub    Private Sub GenBySize(ByVal Acc_Reader As SqlDataReader, ByVal ConUnit As Integer, ByVal BookingUnit As Integer, ByVal BookingConsumption As Decimal, ByVal AccBoolingId As Integer)        Dim Size_connection As New SqlConnection(cnn)        Size_connection.Open()        Dim Size_cmd As SqlCommand = New SqlCommand("Select Distinct SizeId From OrderSizeDetails where OrderDetailsId in (Select OrderDetailsId From OrderDetails Where OrderId= " & OrderIdGridLookUpEdit.EditValue & ") And SizeId in (" & SizeIdCollection() & ")", Size_connection)        Dim Size_reader As SqlDataReader = Size_cmd.ExecuteReader()        While Size_reader.Read()            Dim newRow As AccessoriesBookingNewDataSet.AccessoresBookingDetailsRow = Me.AccessoriesBookingNewDataSet.AccessoresBookingDetails.NewRow()            newRow.FabricColorId = -1            newRow.ItemId = CInt(Acc_Reader("ItemId").ToString)            newRow.Consumption = ConSpinEdit.EditValue            newRow.ConsumptionUnitId = UnitIdGridLookUpEdit.EditValue            newRow.SizeId = CInt(Size_reader("SizeId").ToString())
            'MessageBox.Show(Size_reader("SizeId").ToString())

            Dim BuyerOrderQuantity As Decimal = ReadIntegerData("Select SUM(TTLOrderQuantity) AS TTLOrderQuantity From OrderQuantitySummery_ColorAndSize Where OrderId=" & OrderIdGridLookUpEdit.EditValue & "And SizeId=" & Size_reader("SizeId"), cnn)            newRow.OrderQuantity = BuyerOrderQuantity            If ConUnit = BookingUnit Then

                'BookingQuantity = OrderQuantity / GarmentsQuantity * Consumption * (1 + WastagePercentage / 100)
                newRow.BookingQuantity = FormatNumber(BuyerOrderQuantity / ConPCSSpinEdit.EditValue, 6) * FormatNumber(ConSpinEdit.EditValue, 6) * (1 + FormatNumber(Acc_Reader("WastagePercentage") / 100, 6))            Else                newRow.BookingQuantity = FormatNumber(BuyerOrderQuantity / ConPCSSpinEdit.EditValue, 6) * BookingConsumption * (1 + FormatNumber(Acc_Reader("WastagePercentage") / 100, 6))            End If            newRow.BookingUnitId = Acc_Reader("UnitId").ToString            newRow.AccessoriesBookingId = AccBoolingId
            'newRow.SupplierId = Acc_reader("SupplierId").ToString
            newRow.WastagePercentage = Acc_Reader("WastagePercentage").ToString            newRow.ConsumptionForPcs = ConPCSSpinEdit.EditValue.ToString            newRow.Remarks = "-"
            'newRow.SLNo = Acc_reader("SlNo").ToString
            newRow.UnitPrice = ReadData("Select CurrentPrice From ItemList Where ItemId=" & Acc_Reader("ItemId"), cnn)            newRow.GenerationType = "GenBySize"            Me.AccessoriesBookingNewDataSet.AccessoresBookingDetails.Rows.Add(newRow)        End While        Size_reader.Close()        Size_connection.Close()    End Sub    Private Sub GenByPack(ByVal Acc_Reader As SqlDataReader, ByVal ConUnit As Integer, ByVal BookingUnit As Integer, ByVal BookingConsumption As Decimal, ByVal AccBoolingId As Integer)        Dim Pack_connection As New SqlConnection(cnn)        Pack_connection.Open()

        'Dim Pack_cmd As SqlCommand = New SqlCommand("Select Distinct PackType From OrderDetails where OrderId= " & OrderIdGridLookUpEdit.EditValue, Pack_connection)

        'Dim Color_cmd As SqlCommand = New SqlCommand("Select Distinct FabricColorId From vOrder Where OrderId=" & OrderIdGridLookUpEdit.EditValue & "And FabricColorId in (" & ColorIdCollection() & ")", Color_connection)
        Dim Pack_cmd As SqlCommand = New SqlCommand("Select Distinct PackType From OrderDetails where OrderId= " & OrderIdGridLookUpEdit.EditValue & "And PackType in ('" & PackTypeCollection() & "')", Pack_connection)        Dim Pack_reader As SqlDataReader = Pack_cmd.ExecuteReader()        While Pack_reader.Read()            Dim newRow As AccessoriesBookingNewDataSet.AccessoresBookingDetailsRow = Me.AccessoriesBookingNewDataSet.AccessoresBookingDetails.NewRow()            newRow.FabricColorId = Nothing            newRow.ItemId = CInt(Acc_Reader("ItemId").ToString)            newRow.Consumption = ConSpinEdit.EditValue            newRow.ConsumptionUnitId = UnitIdGridLookUpEdit.EditValue            Dim BuyerOrderQuantity As Integer = ReadIntegerData("Select Sum(OrderQuantity) From [vOrder] Where OrderId=" & OrderIdGridLookUpEdit.EditValue & "And PackType='" & Pack_reader("PackType").ToString() & "'", cnn)            newRow.OrderQuantity = BuyerOrderQuantity            If ConUnit = BookingUnit Then
                'BookingQuantity=OrderQuantity/GarmentsQuantity*Consumption * (1+WastagePercentage/100)

                If ConPCSSpinEdit.EditValue > 0 Then                    newRow.BookingQuantity = FormatNumber(BuyerOrderQuantity / ConPCSSpinEdit.EditValue, 6) * FormatNumber(ConSpinEdit.EditValue, 6) * (1 + FormatNumber(Acc_Reader("WastagePercentage") / 100, 6))                Else                    newRow.BookingQuantity = 0                End If            Else                newRow.BookingQuantity = FormatNumber(BuyerOrderQuantity / ConPCSSpinEdit.EditValue, 6) * BookingConsumption * (1 + FormatNumber(Acc_Reader("WastagePercentage") / 100, 6))            End If            newRow.BookingUnitId = Acc_Reader("UnitId").ToString            newRow.AccessoriesBookingId = AccBoolingId
            'newRow.SupplierId = Acc_Reader("SupplierId").ToString
            newRow.WastagePercentage = Acc_Reader("WastagePercentage").ToString            newRow.ConsumptionForPcs = ConPCSSpinEdit.EditValue.ToString            newRow.Remarks = "-"
            'newRow.SLNo = Acc_reader("SlNo").ToString
            newRow.UnitPrice = ReadData("Select CurrentPrice From ItemList Where ItemId=" & Acc_Reader("ItemId"), cnn)
            'newRow.DestinationId = Destination_reader("DestinationId").ToString
            newRow.PackType = Pack_reader("PackType").ToString            newRow.GenerationType = "GenByPack"            Me.AccessoriesBookingNewDataSet.AccessoresBookingDetails.Rows.Add(newRow)        End While        Pack_reader.Close()        Pack_connection.Close()    End Sub    Private Sub GenByDestination(ByVal Acc_Reader As SqlDataReader, ByVal ConUnit As Integer, ByVal BookingUnit As Integer, ByVal BookingConsumption As Decimal, ByVal AccBoolingId As Integer)        Dim Destination_connection As New SqlConnection(cnn)        Destination_connection.Open()        Dim Destination_cmd As SqlCommand = New SqlCommand("Select Distinct DestinationId From OrderDetails where OrderId= " & OrderIdGridLookUpEdit.EditValue & " And DestinationId in (" & DestinationCollection() & ")", Destination_connection)        Dim Destination_reader As SqlDataReader = Destination_cmd.ExecuteReader()        While Destination_reader.Read()            Dim newRow As AccessoriesBookingNewDataSet.AccessoresBookingDetailsRow = Me.AccessoriesBookingNewDataSet.AccessoresBookingDetails.NewRow()            newRow.FabricColorId = Nothing            newRow.ItemId = CInt(Acc_Reader("ItemId").ToString)            newRow.Consumption = ConSpinEdit.EditValue            newRow.ConsumptionUnitId = UnitIdGridLookUpEdit.EditValue            Dim BuyerOrderQuantity As Decimal = ReadIntegerData("Select Sum(OrderQuantity) From [vOrder] Where OrderId=" & OrderIdGridLookUpEdit.EditValue & " And DestinationId=" & Destination_reader("DestinationId"), cnn)            newRow.OrderQuantity = BuyerOrderQuantity            If ConUnit = BookingUnit Then
                'BookingQuantity=OrderQuantity/GarmentsQuantity*Consumption * (1+WastagePercentage/100)

                If ConPCSSpinEdit.EditValue > 0 Then                    newRow.BookingQuantity = FormatNumber(BuyerOrderQuantity / ConPCSSpinEdit.EditValue, 6) * FormatNumber(ConSpinEdit.Value, 6) * (1 + FormatNumber(Acc_Reader("WastagePercentage") / 100, 6))                Else                    newRow.BookingQuantity = 0                End If            Else                newRow.BookingQuantity = FormatNumber(BuyerOrderQuantity / ConPCSSpinEdit.EditValue, 6) * BookingConsumption * (1 + FormatNumber(Acc_Reader("WastagePercentage") / 100, 6))            End If            newRow.BookingUnitId = Acc_Reader("UnitId").ToString            newRow.AccessoriesBookingId = AccBoolingId
            'newRow.SupplierId = Acc_Reader("SupplierId").ToString
            newRow.WastagePercentage = Acc_Reader("WastagePercentage").ToString            newRow.ConsumptionForPcs = ConPCSSpinEdit.EditValue.ToString            newRow.Remarks = "-"
            'newRow.SLNo = Acc_reader("SlNo").ToString
            newRow.UnitPrice = ReadData("Select CurrentPrice From ItemList Where ItemId=" & Acc_Reader("ItemId"), cnn)            newRow.DestinationId = Destination_reader("DestinationId").ToString            newRow.PackType = ""            newRow.GenerationType = "GenByDestination"            Me.AccessoriesBookingNewDataSet.AccessoresBookingDetails.Rows.Add(newRow)        End While        Destination_reader.Close()        Destination_connection.Close()    End Sub    Private Sub GenByAll(ByVal Acc_Reader As SqlDataReader, ByVal ConUnit As Integer, ByVal BookingUnit As Integer, ByVal BookingConsumption As Decimal, ByVal AccBoolingId As Integer)        On Error Resume Next        Dim newRow As AccessoriesBookingNewDataSet.AccessoresBookingDetailsRow = Me.AccessoriesBookingNewDataSet.AccessoresBookingDetails.NewRow()        newRow.FabricColorId = Nothing        newRow.ItemId = CInt(Acc_Reader("ItemId").ToString)        newRow.Consumption = ConSpinEdit.EditValue        newRow.ConsumptionUnitId = UnitIdGridLookUpEdit.EditValue        Dim BuyerOrderQuantity As Decimal = ReadIntegerData("Select Sum(OrderQuantity) From [vOrder] Where OrderId=" & OrderIdGridLookUpEdit.EditValue, cnn)        newRow.OrderQuantity = BuyerOrderQuantity        If ConUnit = BookingUnit Then
            'BookingQuantity=OrderQuantity/GarmentsQuantity*Consumption * (1+WastagePercentage/100)

            If ConPCSSpinEdit.EditValue > 0 Then                newRow.BookingQuantity = FormatNumber(BuyerOrderQuantity / ConPCSSpinEdit.EditValue, 6) * FormatNumber(ConSpinEdit.EditValue, 6) * (1 + FormatNumber(Acc_Reader("WastagePercentage") / 100, 6))            Else                newRow.BookingQuantity = 0            End If        Else            newRow.BookingQuantity = FormatNumber(BuyerOrderQuantity / ConPCSSpinEdit.EditValue, 6) * BookingConsumption * (1 + FormatNumber(Acc_Reader("WastagePercentage") / 100, 6))        End If        newRow.BookingUnitId = Acc_Reader("UnitId").ToString()        newRow.AccessoriesBookingId = AccBoolingId        newRow.SupplierId = Acc_Reader("SupplierId").ToString        newRow.WastagePercentage = Acc_Reader("WastagePercentage").ToString        newRow.ConsumptionForPcs = ConPCSSpinEdit.EditValue.ToString        newRow.Remarks = "-"
        'newRow.SLNo = Acc_reader("SlNo").ToString
        newRow.UnitPrice = ReadData("Select CurrentPrice From ItemList Where ItemId=" & Acc_Reader("ItemId"), cnn)        newRow.GenerationType = "GenByAll"        Me.AccessoriesBookingNewDataSet.AccessoresBookingDetails.Rows.Add(newRow)    End Sub    Private Sub ApprovedButton_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)        For Each drv As DataRowView In Me.AccessoresBookingDetailsBindingSource.List            If drv!IsSelected = True Then                drv!IsComplete = True                drv!CompleteOn = ReadDateData("Select GetDate()", cnn)            End If        Next    End Sub    Private Sub CareLableSaveButton_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles CareLableSaveButton.Click        If Me.AccessoriesBookingBindingSource.Position > -1 Then            Dim row As AccessoriesBookingNewDataSet.AccessoriesBookingRow            row = CType(CType(Me.AccessoriesBookingBindingSource.Current, DataRowView).Row, AccessoriesBookingNewDataSet.AccessoriesBookingRow)            For Each drv As DataRowView In Me.CareLabelBindingSource.List                If drv!Selected Then

                    'On Error Resume Next
                    Dim newRow As AccessoriesBookingNewDataSet.AccessoriesBookingCareLableRow = Me.AccessoriesBookingNewDataSet.AccessoriesBookingCareLable.NewRow                    newRow.AccessoriesBookingId = row.AccessoriesBookingId                    newRow.CareLable = drv!CareLabel                    Me.AccessoriesBookingNewDataSet.AccessoriesBookingCareLable.Rows.Add(newRow)                End If            Next            Saved()        End If    End Sub    Private Sub SLNoItemTextEdit_ParseEditValue(ByVal sender As System.Object, ByVal e As DevExpress.XtraEditors.Controls.ConvertEditValueEventArgs) Handles SLNoItemTextEdit.ParseEditValue        If (TypeOf e.Value Is String AndAlso e.Value.ToString() = String.Empty) Then            e.Value = DBNull.Value        End If    End Sub    Private Sub AccessoresBookingDetailsBindingSource_PositionChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles AccessoresBookingDetailsBindingSource.PositionChanged        On Error Resume Next        Dim row As AccessoriesBookingNewDataSet.AccessoresBookingDetailsRow        row = CType(CType(Me.AccessoresBookingDetailsBindingSource.Current, DataRowView).Row, AccessoriesBookingNewDataSet.AccessoresBookingDetailsRow)        AccNameGridLookUpEdit.EditValue = row.ItemId        ConSpinEdit.EditValue = row.Consumption        UnitIdGridLookUpEdit.EditValue = row.ConsumptionUnitId        ConPCSSpinEdit.EditValue = row.ConsumptionForPcs        WPercSpinEdit.EditValue = row.WastagePercentage    End Sub    Private Sub UpdateOrderQty()        If Me.AccessoresBookingDetailsBindingSource.Position = -1 Then            Exit Sub        End If        For Each drv As DataRowView In Me.AccessoresBookingDetailsBindingSource.List            If drv!IsComplete = False Then                If drv!GenerationType = "GenByAll" Then                    drv!OrderQuantity = ReadData("Select Sum(OrderQuantity) From OrderDetails Where OrderId=" & OrderIdGridLookUpEdit.EditValue, cnn)                ElseIf drv!GenerationType = "GenByDestination" Then                    drv!OrderQuantity = ReadData("Select Sum(OrderQuantity) From OrderDetails Where OrderId=" & OrderIdGridLookUpEdit.EditValue & " And DestinationId=" & drv!DestinationId, cnn)                ElseIf drv!GenerationType = "GenByPack" Then                    drv!OrderQuantity = ReadIntegerData("Select Sum(OrderQuantity) From OrderDetails Where OrderId=" & OrderIdGridLookUpEdit.EditValue & " And PackType='" & drv!PackType & "'", cnn)                ElseIf drv!GenerationType = "GenByColorAndSize" Then                    drv!OrderQuantity = ReadIntegerData("Select Sum(TTLOrderQuantity) From OrderQuantitySummery_ColorAndSize Where OrderId = " & OrderIdGridLookUpEdit.EditValue & " And FabricColorId = " & drv!FabricColorId & " And SizeId=" & drv!SizeId, cnn)                ElseIf drv!GenerationType = "GenByColor" Then                    Debug.Print("Color: " & drv!FabricColorId.ToString())                    Debug.Print("OrderId: " & OrderIdGridLookUpEdit.EditValue.ToString())                    drv!OrderQuantity = ReadIntegerData("Select Sum(TTLOrderQuantity) From OrderQuantitySummery_ColorAndSize Where OrderId = " & OrderIdGridLookUpEdit.EditValue & " And FabricColorId = " & drv!FabricColorId, cnn)                ElseIf drv!GenerationType = "GenBySize" Then                    drv!OrderQuantity = ReadIntegerData("Select Sum(TTLOrderQuantity) From OrderQuantitySummery_ColorAndSize Where OrderId=" & OrderIdGridLookUpEdit.EditValue & "And SizeId=" & drv!SizeId, cnn)                End If            End If        Next    End Sub    Private Sub AmndButton_Click(sender As Object, e As EventArgs) Handles AmndButton.Click

        'AmendmentNoSpinEdit.Value = AmendmentNoSpinEdit.Value + 1
        'AmendmentDateDateEdit.Text = Today()

        If Me.AccessoriesBookingBindingSource.Position > -1 Then            Dim row As AccessoriesBookingNewDataSet.AccessoriesBookingRow            row = CType(CType(Me.AccessoriesBookingBindingSource.Current, DataRowView).Row, AccessoriesBookingNewDataSet.AccessoriesBookingRow)

            'If row.IsComplete = True Then
            '    MessageBox.Show("Not Done, Already Completed.")
            '    Exit Sub
            'End If

            If MessageBox.Show("Are you sure you want to AMENDMENT this Accessories Booking?", "Confirmation", MessageBoxButtons.YesNo, MessageBoxIcon.Question) = System.Windows.Forms.DialogResult.Yes Then                Dim AmndDetails As String = InputBox("Enter Amendment Details.", "Amendment Details", "")                If AmndDetails = String.Empty Then                    MessageBox.Show("Not Allowed without Amendment Details", "Message")                    Exit Sub                End If                If AmendmentNoSpinEdit.Value > 0 Then                    Dim newRow As AccessoriesBookingNewDataSet.AccessoriesBookingAmndDetailsRow = Me.AccessoriesBookingNewDataSet.AccessoriesBookingAmndDetails.NewRow()                    newRow.AccessoriesBookingId = row.AccessoriesBookingId                    newRow.AmndNo = AmendmentNoSpinEdit.Value                    newRow.AmndDate = AmendmentDateDateEdit.DateTime.Date                    newRow.Details = AmndDetails                    Me.AccessoriesBookingNewDataSet.AccessoriesBookingAmndDetails.Rows.Add(newRow)                    row.AmendmentNo = AmendmentNoSpinEdit.Value + 1                    row.AmendmentDate = Now()                    row.IsComplete = False                    UpdateOrderQty()

                    'Recalculate all data.
                    AccessoresBookingDetailsBindingSource.MoveFirst()                    Recalculate()                    Dim index As Int16 = 0                    For index = 0 To AccessoresBookingDetailsBindingSource.Count - 1                        AccessoresBookingDetailsBindingSource.MoveNext()                        Recalculate()                    Next                    Save()                Else                    row.AmendmentNo = Me.AmendmentNoSpinEdit.Value + 1                    row.AmendmentDate = Now()                    row.IsComplete = False                    row.AmendmentDetails = AmndDetails                    UpdateOrderQty()

                    'Recalculate all data.
                    AccessoresBookingDetailsBindingSource.MoveFirst()                    Recalculate()                    Dim index As Int16 = 0                    For index = 0 To AccessoresBookingDetailsBindingSource.Count - 1                        AccessoresBookingDetailsBindingSource.MoveNext()                        Recalculate()                    Next                    Save()                End If            End If        End If    End Sub    Private Sub IsCompleteCheckEdit_CheckedChanged_1(sender As Object, e As EventArgs) Handles IsCompleteCheckEdit.CheckedChanged
        'If IsCompleteCheckEdit.Checked Then
        '    ExecuteQuery("Update [Order] Set IsAccBOMComplete=1 Where OrderId=" & OrderIdGridLookUpEdit.EditValue, cnn)
        'Else
        '    ExecuteQuery("Update [Order] Set IsAccBOMComplete=0 Where OrderId=" & OrderIdGridLookUpEdit.EditValue, cnn)
        'End If
    End Sub    Private Sub RecalculateButton_Click(sender As Object, e As EventArgs) Handles RecalculateButton.Click        AccessoresBookingDetailsBindingSource.MoveFirst()        Recalculate()        Dim index As Int16 = 0        For index = 0 To AccessoresBookingDetailsBindingSource.Count - 1            AccessoresBookingDetailsBindingSource.MoveNext()            Recalculate()        Next    End Sub    Function CheckFullComplete() As Boolean        Dim flag As Boolean = True        For Each drv As DataRowView In Me.AccessoresBookingDetailsBindingSource.List            If drv!IsComplete = False Then                flag = False                GoTo Line1            End If        NextLine1:        Return flag    End Function    Private Sub SelectSimpleButton_Click(sender As Object, e As EventArgs) Handles SelectSimpleButton.Click        If SelectSimpleButton.Text = "&Select All" Then            For Each drv As DataRowView In Me.AccessoresBookingDetailsBindingSource.List                drv!IsSelected = True            Next            Me.AccessoresBookingDetailsBindingSource.ResetBindings(True)            SelectSimpleButton.Text = "&Deselect All"        Else            For Each drv As DataRowView In Me.AccessoresBookingDetailsBindingSource.List                drv!IsSelected = False            Next            Me.AccessoresBookingDetailsBindingSource.ResetBindings(True)            SelectSimpleButton.Text = "&Select All"        End If    End Sub    Private Sub SimpleButton1_Click(sender As Object, e As EventArgs) Handles SimpleButton1.Click        For Each drv As DataRowView In Me.AccessoresBookingDetailsBindingSource.List            If drv!IsSelected = True Then                drv!IsComplete = True                drv!CompleteOn = ReadDateData("Select GetDate()", cnn)            End If        Next    End Sub    Private Sub GridView1_ShowingEditor(sender As Object, e As System.ComponentModel.CancelEventArgs) Handles GridView1.ShowingEditor        If Convert.ToBoolean(GridView1.GetRowCellValue(GridView1.FocusedRowHandle, GridView1.Columns("IsApproved"))) Then            e.Cancel = True        End If    End SubEnd Class